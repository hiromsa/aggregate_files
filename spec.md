# 🚀 最終統合プロジェクト情報集約ツール 作成指示書

## 💡 目的 (Goal)

入力が**ローカルディレクトリパス**か**Web URL**かに関わらず、再帰的に構造化された情報を抽出し、サポート対象のドキュメント（.xlsx, .docx, .pdf）を含むコンテンツを単一のMarkdownファイルに集約する**Pythonバックエンド**を作成し、それを実行するための**Streamlit GUI**を作成する。

---

## 💻 実行環境と依存関係 (Dependencies)

* **言語:** Python 3
* **必須ライブラリ:**
    * **GUI:** `streamlit`
    * **Web処理:** `requests`, `BeautifulSoup4`
    * **ファイル処理:** `pdfplumber`, `openpyxl`, `python-docx`

---

## 📁 パート 1: バックエンド Pythonスクリプト (`aggregate_files.py`)

### 1. 機能要件

#### A. コマンドライン引数

| 引数名 | 説明 |
| :--- | :--- |
| **`input_source`** | ファイルを集約する**ルートディレクトリ**または**開始URL**。 |
| **`output_file`** | 集約された内容を書き出す**出力テキストファイル**のパス。 |

#### B. 処理分岐と範囲制限

`input_source` が `http://` または `https://` で始まるかを確認し、ローカルファイル処理と Webクローラー処理に分岐させる。

1.  **Webクローラー処理:**
    * **制限 (最重要):** クロールは、指定された `input_source` の**ドメイン**内、かつ**ルートパス配下**に厳密に制限すること。
    * **Web上バイナリファイル:** Web上で `.xlsx`, `.docx`, `.pdf` を見つけた場合、ダウンロードしてテキストを抽出する。
    * **制御:** サーバー負荷軽減のため、リクエスト間に最低 `1` 秒の遅延 (`time.sleep(1)`) を入れること。

2.  **ローカルファイル処理:**
    * **バイナリ処理の追加:** 以下のファイル形式に対応し、抽出テキストを出力に含めること。
        * `.pdf` (テキスト抽出)
        * `.xlsx` (`openpyxl` を使用し、すべてのシートのデータをテキスト化)
        * `.docx` (`python-docx` を使用し、すべての段落テキストを抽出)

#### C. ファイルフィルタリングと記録（共通）

* **除外リスト (スキップ):** `bin`, `obj`, `.git`, `.vs`, `__pycache__`, `node_modules`, `.exe`, `.dll`, `.pdb`, `.zip`, `.tar.gz`, `.log`, `.jpg`, `.jpeg`, `.png`, `.ico`, `.css`, `.js` はスキップする。
* **未対応ファイルの記録 (重要):**
    * **`.xls`** および **`.doc`** ファイルを発見した場合、内容は読み取らずにスキップする。
    * ただし、出力ファイルの該当セクションに**パスと、読み取りをスキップした旨の警告メッセージ**を記述すること。

    **＜未対応ファイル出力フォーマット例＞**
    ```markdown
    # File: docs/old_spec.doc
    ```text
    [WARNING: The file format (.doc) is not supported. Content was skipped.]
    ```

#### D. 出力フォーマット（共通）

* **ヘッダー:** `# File:` または `# URL:` ヘッダーを使用する。
* **コードブロック:** 内容はMarkdownのコードブロックで囲み、適切なシンタックスハイライトを使用すること（`.xlsx`、`.docx`、`.pdf`、未対応ファイルはすべて `text`）。

---

## 🖥️ パート 2: Streamlit GUI フロントエンド (`app.py`)

### 1. 機能要件

#### A. インターフェース

* **タイトル:** 適切なアプリケーション名を表示すること。
* **入力フィールド:**
    1.  **`Input Source (Local Path or URL)`** 用のテキスト入力フィールド。
    2.  **`Output File Path`** 用のテキスト入力フィールド（デフォルト値：`./ai_summary.md`）。
* **実行ボタン:** **`Start Aggregation`** ボタンを設置すること。

#### B. 動作ロジック

* ユーザーがボタンを押すと、入力されたパスとファイル名を取得する。
* `aggregate_files.py` を、Pythonの `subprocess` モジュールを使って**外部プロセスとして実行**する。
* コマンド形式：`python aggregate_files.py [Input Source] [Output File Path]`

#### C. フィードバック

* **ログ表示:** 実行中の `aggregate_files.py` からの標準出力（`stdout`）をキャプチャし、StreamlitのUI上にリアルタイムで表示すること。
* **完了通知:** スクリプトがエラーなく完了した場合、緑色の成功メッセージを表示すること。エラーが発生した場合は、赤色のエラーメッセージを表示すること。